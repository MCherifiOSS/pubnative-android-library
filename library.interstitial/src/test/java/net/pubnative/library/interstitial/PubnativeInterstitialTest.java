package net.pubnative.library.interstitial;

import android.app.Activity;

import org.junit.Test;
import org.junit.runner.RunWith;
import org.robolectric.Robolectric;
import org.robolectric.RobolectricGradleTestRunner;
import org.robolectric.annotation.Config;
import net.pubnative.library.exceptions.PubnativeException;

import static org.mockito.Matchers.eq;
import static org.mockito.Mockito.spy;
import static org.mockito.Mockito.verify;
import static org.mockito.Mockito.when;

@Config(constants = BuildConfig.class, sdk = 16)
@RunWith(RobolectricGradleTestRunner.class)
public class PubnativeInterstitialTest {

    @Test
    public void loadInterstitial_withNullContext_invokeLoadFail() {

        String appToken = "123456";

        PubnativeInterstitial interstitial = spy(PubnativeInterstitial.class);
        interstitial.mListener = spy(PubnativeInterstitial.Listener.class);
        interstitial.load(null, appToken);
        verify(interstitial).invokeLoadFail(eq(PubnativeException.CONTEXT_IS_NULL));

    }

    @Test
    public void loadInterstitial_withEmptyAppToken_invokeLoadFail() {

        String appToken = "";
        Activity activity = Robolectric.buildActivity(Activity.class).create().get();

        PubnativeInterstitial interstitial = spy(PubnativeInterstitial.class);
        interstitial.mListener = spy(PubnativeInterstitial.Listener.class);
        interstitial.load(activity, appToken);
        verify(interstitial).invokeLoadFail(eq(PubnativeException.APPTOKEN_IS_NULL_OR_EMPTY));

    }

    @Test
    public void loadIterstitial_whenReady_invokeLoadFinish() {

        String appToken = "123456";
        Activity activity = Robolectric.buildActivity(Activity.class).create().get();

        PubnativeInterstitial interstitial = spy(PubnativeInterstitial.class);
        interstitial.mListener = spy(PubnativeInterstitial.Listener.class);

        when(interstitial.isReady()).thenReturn(true);

        interstitial.load(activity, appToken);
        verify(interstitial).invokeLoadFinish();

    }

}
